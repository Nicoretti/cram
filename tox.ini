[tox]
envlist=integration-{dash,bash,zsh},coverage

[testenv]
setenv =
    PYTHONPATH = {envpython}
    PYTHONPATH = {toxinidir}
     dash: TESTOPTS = --shell=dash
     bash: TESTOPTS = --shell=bash
     zsh: TESTOPTS = --shell=zsh
deps =
    -r{toxinidir}/requirements.txt

[testenv:integration-{dash,bash,zsh}]
commands =
    prysk {env:TESTOPTS:--shell=bash} {toxinidir}/test/integration

[testenv:coverage]
setenv =
    COVERAGE = coverage
    COVERAGE_FILE={toxinidir}/.coverage

commands =
    coverage run -a --rcfile={toxinidir}/.coveragerc -m prysk.cli {env:TESTOPTS:--shell=bash} {toxinidir}/test/integration/prysk
    coverage run -a --rcfile={toxinidir}/.coveragerc -m prysk.cli {env:TESTOPTS:--shell=dash} {toxinidir}/test/integration/prysk
    coverage run -a --rcfile={toxinidir}/.coveragerc -m prysk.cli {env:TESTOPTS:--shell=zsh} {toxinidir}/test/integration/prysk
    coverage report --fail-under=97
    coverage lcov
